<!DOCTYPE html>
<html>
    <body>
        <div><span id="error"></span></div>
        <div>
            <span id="to"></span>

        </div>

        <script>

            HTTP_GET_VARS = new Array();
            strGET = document.location.search.substr(1, document.location.search.length);
            if (strGET != '')
            {
                gArr = strGET.split('&');
                for (i = 0; i < gArr.length; ++i)
                {
                    v = '';
                    vArr = gArr[i].split('=');
                    if (vArr.length > 1) {
                        v = vArr[1];
                    }
                    HTTP_GET_VARS[unescape(vArr[0])] = unescape(v);
                }
            }


            function GET(v)
            {
                if (!HTTP_GET_VARS[v]) {
                    return 'undefined';
                }
                return HTTP_GET_VARS[v];
            }
            function checkUrl(url) {
                var request = false;
                if (window.XMLHttpRequest) {
                    request = new XMLHttpRequest;
                } else if (window.ActiveXObject) {
                    request = new ActiveXObject("Microsoft.XMLHttp");
                }

                if (request) {
                    request.open("GET", url);
                    if (request.status == 200) {
                        return true;
                    }
                }
                return false;
            }


            if (window.XMLHttpRequest)
            {// code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            }
            else
            {// code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }

            var repo_url = "http://serv21.ub.uni-heidelberg.de:8080/fedora/rest/";
            var url = GET('collection');
            
            if (url == '') {
                document.getElementById("error").innerHTML = 'collection undefined: e.f. collection=mycollection';

            }
            //check if the collection exists
            if (checkUrl(repo_url+url) == false) {
                document.getElementById("error").innerHTML = 'collection do not exist';
            }
            else {


                xmlhttp.open("GET", repo_url + url + "/fcr:export", false);
                //xmlhttp.open("GET", "http://serv21.ub.uni-heidelberg.de:8080/fedora/rest/de/uni-heidelberg/ub/digi/diglit/lehmann1756/0001/fcr:export", false);
                xmlhttp.send();
                xmlDoc = xmlhttp.responseXML;


                //var response = transport.responseXML.getElementsByTagName("value");
                var ns = "http://www.jcp.org/jcr/sv/1.0";
                var collection = xmlDoc.getElementsByTagNameNS(ns, "node");


                var getElementsByTagNameNS = function(node, ns, tagName) {
                    if (node.getElementsByTagNameNS) {
                        return node.getElementsByTagNameNS(ns, tagName);
                    }

                    return node.getElementsByTagName(ns + ':' + tagName);
                };

                var prop = '';
                for (var i = 0; i < collection.length; i++) {
                    anno = collection[i].children;
                    prop += '<h1>' + i + '</h1>';
                    for (j = 0; j < anno.length; j++) {
                        prop += '<h2>' + j + '</h2>';
                        prop += anno[j].attributes[0].nodeValue;
                        prop += '<br>' + anno[j].innerHTML + '</br>';

                    }



                }
                document.getElementById("to").innerHTML = prop;
            }

        </script>


    </body>
</html>
